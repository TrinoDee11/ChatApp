
<%- include('../partials/header') %>
<section class="bg-white rounded-4 p-4 p-md-5 shadow-sm" style="border: 1px solid rgba(0,0,0,0.03); max-width: 440px; margin: 0 auto;">
  <!-- Header -->
  <div class="text-center mb-5">
    <div class="bg-success bg-opacity-10 rounded-circle p-3 d-flex align-items-center justify-content-center mx-auto mb-4" 
         style="width: 80px; height: 80px;">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- SVG paths remain the same -->
      </svg>
    </div>
    <h1 class="h3 fw-semibold mb-2" style="color: #212529;">Create account</h1>
    <p class="text-muted" style="font-size: 0.9375rem;">Join our community today</p>
  </div>

  <% if (error) { %>
  <div class="alert bg-danger bg-opacity-10 border border-danger border-opacity-10 rounded-3 p-3 mb-4" 
       style="font-size: 0.875rem;">
    <div class="d-flex align-items-center">
      <svg width="18" height="18" fill="#dc3545" viewBox="0 0 16 16" class="me-2 flex-shrink-0">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
      </svg>
      <div><%= error %></div>
    </div>
  </div>
  <% } %>

  <form method="POST" action="/register" class="mt-3" id="registrationForm">
    <!-- Username Field -->
    <div class="mb-4">
      <label class="form-label d-block mb-2" style="font-size: 0.8125rem; font-weight: 500; color: #495057;">Username</label>
      <input 
        type="text" 
        name="name" 
        class="form-control rounded-3 py-2 px-3" 
        value="<%= form.name || '' %>" 
        required
        placeholder="Enter your username"
        style="border-color: #dee2e6; font-size: 0.9375rem;"
      >
    </div>

    <!-- Email Field -->
    <div class="mb-4">
      <label class="form-label d-block mb-2" style="font-size: 0.8125rem; font-weight: 500; color: #495057;">Email</label>
      <input 
        type="email" 
        name="email" 
        class="form-control rounded-3 py-2 px-3" 
        value="<%= form.email || '' %>" 
        required
        placeholder="your@email.com"
        style="border-color: #dee2e6; font-size: 0.9375rem;"
      >
    </div>

    <!-- Password Field with Validation -->
    <div class="mb-4">
      <label class="form-label d-block mb-2" style="font-size: 0.8125rem; font-weight: 500; color: #495057;">Password</label>
      <div class="input-group">
        <input 
          type="password" 
          name="password" 
          class="form-control rounded-3 py-2 px-3" 
          required
          placeholder="Create a password"
          style="border-color: #dee2e6; font-size: 0.9375rem;"
          id="passwordField"
          pattern="^(?=.*\d)(?=.*[!@#$%^&*])(?=.*[a-zA-Z]).{8,}$"
          title="Password must be at least 8 characters long and include a number and symbol"
        >
        <button class="btn btn-outline-secondary border-start-0 bg-transparent" type="button" id="togglePassword" style="border-color: #dee2e6;">
          <svg width="18" height="18" fill="#6c757d" viewBox="0 0 16 16" id="eyeIcon">
            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
          </svg>
        </button>
      </div>
      <div id="passwordRequirements" class="mt-2">
        <small class="text-muted d-block" style="font-size: 0.75rem;">
          <span id="lengthCheck" class="text-danger">✗ At least 8 characters</span><br>
          <span id="numberCheck" class="text-danger">✗ Contains a number</span><br>
          <span id="symbolCheck" class="text-danger">✗ Contains a symbol</span>
        </small>
      </div>
    </div>

    <!-- Submit Button -->
    <button 
      type="submit" 
      class="btn w-100 py-2 rounded-3 border-0 text-white fw-medium mt-2" 
      style="background-color: #34C759; font-size: 0.9375rem; box-shadow: 0 2px 8px rgba(52, 199, 89, 0.2);"
      id="submitBtn"
    >
      Sign Up
    </button>
  </form>

  <div class="text-center mt-4 pt-3" style="border-top: 1px solid #e9ecef;">
    <p class="text-muted mb-0" style="font-size: 0.875rem;">
      Have an account? <a href="/login" class="text-decoration-none fw-medium" style="color: #34C759;">Log in</a>
    </p>
  </div>
</section>

<script>
  // Password visibility toggle
  document.getElementById('togglePassword').addEventListener('click', function() {
    const passwordInput = document.getElementById('passwordField');
    const eyeIcon = document.getElementById('eyeIcon');
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      eyeIcon.setAttribute('fill', '#34C759');
    } else {
      passwordInput.type = 'password';
      eyeIcon.setAttribute('fill', '#6c757d');
    }
  });

  // Password validation
  const passwordField = document.getElementById('passwordField');
  const lengthCheck = document.getElementById('lengthCheck');
  const numberCheck = document.getElementById('numberCheck');
  const symbolCheck = document.getElementById('symbolCheck');
  const submitBtn = document.getElementById('submitBtn');

  passwordField.addEventListener('input', function() {
    const password = this.value;
    
    // Validate length
    if (password.length >= 8) {
      lengthCheck.classList.remove('text-danger');
      lengthCheck.classList.add('text-success');
      lengthCheck.innerHTML = '✓ At least 8 characters';
    } else {
      lengthCheck.classList.remove('text-success');
      lengthCheck.classList.add('text-danger');
      lengthCheck.innerHTML = '✗ At least 8 characters';
    }
    
    // Validate number
    if (/\d/.test(password)) {
      numberCheck.classList.remove('text-danger');
      numberCheck.classList.add('text-success');
      numberCheck.innerHTML = '✓ Contains a number';
    } else {
      numberCheck.classList.remove('text-success');
      numberCheck.classList.add('text-danger');
      numberCheck.innerHTML = '✗ Contains a number';
    }
    
    // Validate symbol
    if (/[!@#$%^&*]/.test(password)) {
      symbolCheck.classList.remove('text-danger');
      symbolCheck.classList.add('text-success');
      symbolCheck.innerHTML = '✓ Contains a symbol';
    } else {
      symbolCheck.classList.remove('text-success');
      symbolCheck.classList.add('text-danger');
      symbolCheck.innerHTML = '✗ Contains a symbol';
    }
    
    // Enable/disable submit button
    const isValid = password.length >= 8 && /\d/.test(password) && /[!@#$%^&*]/.test(password);
    submitBtn.disabled = !isValid;
    submitBtn.style.opacity = isValid ? '1' : '0.7';
    submitBtn.style.cursor = isValid ? 'pointer' : 'not-allowed';
  });

  // Form validation
  document.getElementById('registrationForm').addEventListener('submit', function(e) {
    const password = passwordField.value;
    if (password.length < 8 || !/\d/.test(password) || !/[!@#$%^&*]/.test(password)) {
      e.preventDefault();
      alert('Please ensure your password meets all requirements');
    }
  });
</script>
<%- include('../partials/footer') %>
